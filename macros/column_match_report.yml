version: 2
macros:
  - name: column_match_report
    description: >
     This macro aims to quantify data compatibility between tables at column level, by comparing
     each column from the refactored table with its correspondent counterpart from the legacy table.
     By declaring an effective primary key, it is possible to fully join both tables and compare
     the data compatibility between columns, which is measured through these 7 basic metrics,
     related to total row number resultant from the full join applied:
     * Perfect match (%);
     * Both values are null (%);
     * Values do not match (%);
     * Value null only in old (%);
     * Value null only in new (%);
     * Value missing from old (%);
     * Value missing from new (%).
    A total match ratio metric is generated by summing the “perfect match” and “both are null” metrics,
    and can be translated as a total column compatibility ratio.
    arguments:
      - name: old_query
        type: varchar
        description: >
         A regular SQL query referencing the legacy model. Note that standard SQL operations (like casting)
         can be applied to the columns, enabling the AE to test different approaches to certain logic and
         see how they perform in terms of data compatibility with the other table.
      - name: new_query
        type: varchar
        description: >
         A regular SQL query referencing the refactored model. Note that standard SQL operations (like casting)
         can be applied to the columns, enabling the AE to test different approaches to certain logic and
         see how they perform in terms of data compatibility with the other table.
      - name: primary_key
        type: varchar
        description: >
         Name of the primary key column used to join both tables. Note that the columns need to have the same name
         in the legacy and in the refactored table. The column renaming can be done within the old_query and new_query
         arguments.
      - name: columns_to_compare
        type: varchar
        description: >
         List of names of the columns to be evaluated by the macro. Can include the primary key column. The columns
         need to have the same name in the legacy and in the refactored table. The column renaming can be done within
         the old_query and new_query arguments.
      - name: model_name
        type: varchar
        description: >
         Name attributed to the model evaluated, for tracking purposes.
    docs:
     show: true
